{% extends 'base.html' %}

{% block head %}
<meta name="description" content="{{ blogBase['title'] }} ä»ç½‘ç›˜æœç´¢å„ç§èµ„æº">
<meta name="keywords" content="ç½‘ç›˜ï¼Œç½‘ç›˜æœç´¢ï¼Œç™¾åº¦ç½‘ç›˜ï¼Œé˜¿é‡Œäº‘ç›˜ï¼Œè…¾è®¯å¾®äº‘ï¼Œå¤©ç¿¼äº‘ç›˜ï¼Œ123äº‘ç›˜ï¼Œè¿…é›·äº‘ç›˜ï¼Œè“å¥äº‘ï¼Œåšæœäº‘ï¼Œå’Œå½©äº‘â€Œï¼Œä¼ä¸šç½‘ç›˜â€Œï¼Œäº¿æ–¹äº‘ï¼ŒGoogle Driveï¼ŒDropboxï¼ŒOneDrive">
<title>{{ blogBase['title'] }} - ç½‘ç›˜æœç´¢</title>
{% endblock %}

{% block style %}
<style>
/* --- é¡µé¢æ ‡é¢˜å’Œå³ä¸Šè§’æŒ‰é’®æ ·å¼ (å‚è€ƒtag.html) --- */
/* [å…³é”®ä¿®æ”¹] ä» .pageTitle ä¸­åˆ é™¤äº† font-size:40px; */
.pageTitle{margin:auto 0;font-weight:bold;overflow:hidden;white-space:nowrap;text-overflow:ellipsis;}
.title-right{display:flex;margin:auto 0 0 auto;}
.title-right .circle{padding: 14px 16px;margin-right:8px;}

/* --- ç›˜æœUIæ ·å¼ --- */
#pansou-container {
    padding: 20px;
    border: 1px solid var(--borderColor-default, var(--color-border-default));
    border-radius: 6px;
    margin-bottom: 2.5rem;
}
.search-box {
    display: flex;
    gap: 10px;
    margin-bottom: 20px;
}
#pansou-input {
    flex-grow: 1;
    padding: 10px;
    border: 1px solid var(--borderColor-default, var(--color-border-default));
    border-radius: 6px;
    font-size: 16px;
    background-color: var(--bgColor-default, var(--color-canvas-default));
    color: var(--fgColor-default, var(--color-fg-default));
}
#pansou-button {
    padding: 10px 20px;
    border-radius: 6px;
    background-color: var(--color-btn-primary-bg, #2ea44f);
    color: var(--color-btn-primary-text, #ffffff);
    border: 1px solid var(--color-btn-primary-border, rgba(27,31,36,0.15));
    font-size: 16px;
    cursor: pointer;
}
#pansou-button:hover {
    background-color: var(--color-btn-primary-hover-bg, #2c974b);
}
#pansou-results {
    font-family: -apple-system,BlinkMacSystemFont,"Segoe UI",Helvetica,Arial,sans-serif,"Apple Color Emoji","Segoe UI Emoji";
}
.results-summary {
    font-weight: bold;
    margin-bottom: 15px;
}
.result-category {
    margin-bottom: 20px;
}
.category-title {
    font-size: 20px;
    font-weight: bold;
    margin-bottom: 10px;
    text-transform: capitalize; /* é¦–å­—æ¯å¤§å†™ */
    border-bottom: 2px solid var(--borderColor-default, var(--color-border-default));
    padding-bottom: 5px;
}
.result-item {
    list-style-type: none;
    margin-bottom: 15px;
    padding-left: 0;
}
.result-item a {
    font-weight: 600;
    color: var(--color-accent-fg, #0969da);
    text-decoration: none;
}
.result-item a:hover {
    text-decoration: underline;
}
.result-note {
    font-size: 14px;
    color: var(--color-fg-muted, #57606a);
    margin-top: 4px;
    word-break: break-all;
}
.result-password {
    font-weight: bold;
    color: var(--color-danger-fg, #cf222e);
    margin-left: 8px;
}
.result-source {
    font-size: 12px;
    color: #888;
    display: block;
    margin-top: 5px;
}
</style>
{% endblock %}

{% block header %}
<h1 class="pageTitle">ç½‘ç›˜èµ„æºæœç´¢-æœªæ¥ä¼ åª’-å…³æ³¨ä¸­å¹´äºº</h1>
<div class="title-right">
    <a href="{{ blogBase['homeUrl'] }}" id="buttonHome" class="btn btn-invisible circle" title="{{ i18n['home'] }}">
        <svg class="octicon" width="16" height="16">
            <path id="pathHome" fill-rule="evenodd"></path>
        </svg>
    </a>
    <a class="btn btn-invisible circle" onclick="modeSwitch()" title="{{ i18n['switchTheme'] }}" {%- if blogBase['themeMode']=='fix' -%}style="display:none;"{%- endif -%}>
        <svg class="octicon" width="16" height="16" >
            <path id="themeSwitch" fill-rule="evenodd"></path>
        </svg>
    </a>
</div>
{% endblock %}

{% block content %}
<div id="search">
    <div id="pansou-container">
        <div class="search-box">
            <input type="text" id="pansou-input" placeholder="è¾“å…¥å…³é”®è¯æœç´¢ç½‘ç›˜èµ„æº...">
            <button id="pansou-button">ç›˜æœä¸€ä¸‹</button>
        </div>
        <div id="pansou-results">
            </div>
    </div>
</div>
{% endblock %}

{% block script %}
<script>
    document.addEventListener('DOMContentLoaded', () => {
        const searchInput = document.getElementById('pansou-input');
        const searchButton = document.getElementById('pansou-button');
        const resultsContainer = document.getElementById('pansou-results');
        const apiUrl = 'https://www.futuremedia.work/api-proxy/'; // ä½¿ç”¨Cloudflareä»£ç†åœ°å€

        const performSearch = () => {
            const keyword = searchInput.value.trim();
            if (!keyword) {
                alert('è¯·è¾“å…¥æœç´¢å…³é”®è¯ï¼');
                return;
            }

            resultsContainer.innerHTML = '<p>ğŸš€ æ­£åœ¨å…¨é€Ÿæœç´¢ä¸­ï¼Œè¯·ç¨å€™...</p>';

            fetch(`${apiUrl}?kw=${encodeURIComponent(keyword)}`)
                .then(response => {
                    if (!response.ok) {
                        return response.json().then(err => { throw new Error(err.message || 'ç½‘ç»œè¯·æ±‚å¤±è´¥') });
                    }
                    return response.json();
                })
                .then(data => {
                    renderResults(data);
                })
                .catch(error => {
                    console.error('æœç´¢å‡ºé”™:', error);
                    resultsContainer.innerHTML = `<p style="color: red;">âŒ æœç´¢å¤±è´¥ï¼š${error.message}</p>`;
                });
        };

        const renderResults = (data) => {
            // [ä¿®æ­£] ä» data.data ä¸­è¯»å– merged_by_type
            if (!data || !data.data || !data.data.merged_by_type || Object.keys(data.data.merged_by_type).length === 0) {
                resultsContainer.innerHTML = `<p class="results-summary">æœªæ‰¾åˆ°ä¸ "${searchInput.value}" ç›¸å…³çš„ç½‘ç›˜èµ„æºã€‚</p>`;
                return;
            }
            
            // [ä¿®æ­£] ä» data.data ä¸­è®¡ç®—æ€»é“¾æ¥æ•°
            let totalLinks = 0;
            for (const type in data.data.merged_by_type) {
                totalLinks += data.data.merged_by_type[type].length;
            }

            let html = `<p class="results-summary">ğŸ‰ å…±æ‰¾åˆ° ${totalLinks} ä¸ªç›¸å…³èµ„æºé“¾æ¥ï¼š</p>`;
            
            // [ä¿®æ­£] ä» data.data ä¸­è·å–ç»“æœåˆ†ç±»
            const categories = data.data.merged_by_type;
            
            for (const type in categories) {
                if (categories[type].length > 0) {
                    html += `<div class="result-category">`;
                    html += `<h3 class="category-title">${type}</h3>`;
                    html += `<ul>`;
                    
                    categories[type].forEach(item => {
                        html += `<li class="result-item">`;
                        html += `<a href="${item.url}" target="_blank" rel="noopener noreferrer">${item.note || 'æ— æ ‡é¢˜'}</a>`;
                        
                        if (item.password) {
                            html += `<span class="result-password">å¯†ç : ${item.password}</span>`;
                        }
                        
                        html += `<p class="result-note">${item.url}</p>`;
                        html += `<span class="result-source">æ¥æº: ${item.source} | æ—¶é—´: ${new Date(item.datetime).toLocaleString()}</span>`;
                        html += `</li>`;
                    });
                    
                    html += `</ul>`;
                    html += `</div>`;
                }
            }
            
            resultsContainer.innerHTML = html;
        };

        searchButton.addEventListener('click', performSearch);
        searchInput.addEventListener('keyup', (event) => {
            if (event.key === 'Enter') {
                performSearch();
            }
        });
    });
</script>

<script>
// å›¾æ ‡åŠ è½½è„šæœ¬ (å‚è€ƒtag.html)
document.getElementById("pathHome").setAttribute("d",IconList["home"]);
</script>
{% endblock %}
