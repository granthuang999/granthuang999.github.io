{% extends 'base.html' %}

{% block head %}
<meta name="description" content="{{ blogBase['description'] }}">
<meta property="og:title" content="{{ blogBase['postTitle'] }}">
<meta property="og:description" content="{{ blogBase['description'] }}">
<meta property="og:type" content="article">
<meta property="og:url" content="{{ blogBase['postUrl'] }}">
<meta property="og:image" content="{{ blogBase['ogImage'] }}">
<title>{{ blogBase['postTitle'] }}</title>
{% if blogBase['highlight']==1 %}<link href="//unpkg.com/@wooorm/starry-night@2.1.1/style/both.css" rel="stylesheet" />{% endif %}
{{ blogBase['head'] }}
{% endblock %}

{% block style %}
<style>
.postTitle{margin: auto 0;font-size:40px;font-weight:bold;}
.title-right{display:flex;margin:auto 0 0 auto;}
.title-right .circle{padding: 14px 16px;margin-right:8px;}
#postBody{border-bottom: 1px solid var(--color-border-default);padding-bottom:36px;}
#postBody hr{height:2px;}
.g-emoji{font-size:24px;}

/* [新增] 为TOC目录和文章主体布局 */
.main-content-container {
    display: flex;
    flex-direction: row-reverse; /* 目录在右侧 */
    gap: 24px;
}
.article-content {
    flex-grow: 1;
    min-width: 0; /* 防止内容溢出 */
}
.toc-container {
    flex-shrink: 0;
    width: 240px; /* 目录宽度 */
    position: sticky;
    top: 2rem; /* 滚动时固定在顶部 */
    align-self: flex-start; /* 确保从顶部开始对齐 */
    max-height: calc(100vh - 4rem); /* 防止目录过长 */
    overflow-y: auto;
}

@media (max-width: 1024px) {
    /* 在小屏幕上，将目录移动到文章上方 */
    .main-content-container {
        flex-direction: column;
    }
    .toc-container {
        position: static;
        width: 100%;
        margin-bottom: 2rem;
        max-height: none;
    }
}

@media (max-width: 600px) {
    body {padding: 8px;}
    .postTitle{font-size:24px;}
    .post-footer { flex-direction: column; align-items: flex-start; }
}

.post-footer {
    display: flex;
    justify-content: space-between;
    align-items: center;
    flex-wrap: wrap; 
    gap: 16px; 
    margin-top: 1.5rem;
    padding-top: 1rem;
    border-top: 1px solid var(--borderColor-default, var(--color-border-default));
}
.share-buttons-inline {
    display: flex;
    align-items: center;
    gap: 8px; 
}
.share-button {
    display: inline-block;
    padding: 4px 12px; 
    border-radius: 6px;
    color: #ffffff !important;
    text-decoration: none;
    font-size: 12px; 
    transition: opacity 0.3s;
    border: none;
}
.share-button:hover { opacity: 0.85; }
.bottom-text-inline { font-size: small; white-space: nowrap; }
.share-button.x { background-color: #1DA1F2; }
.share-button.facebook { background-color: #1877F2; }
.share-button.linkedin { background-color: #0A66C2; }
.share-button.weibo { background-color: #e6162d; }
.share-button.telegram { background-color: #26A5E4; }
</style>
<style>
{{ blogBase['style']|safe }}
</style>
{% endblock %}

{% block header %}
<h1 class="postTitle">{{ blogBase['postTitle'] }}</h1>
<div class="title-right">
    <a href="{{ blogBase['homeUrl'] }}" id="buttonHome" class="btn btn-invisible circle" title="{{ i18n['home'] }}">
        <svg class="octicon" width="16" height="16"><path id="pathHome" fill-rule="evenodd"></path></svg>
    </a>
    {% if blogBase['showPostSource']==1 %}
    <a href="{{ blogBase['postSourceUrl'] }}" target="_blank" class="btn btn-invisible circle" title="Issue">
        <svg class="octicon" width="16" height="16"><path id="pathIssue" fill-rule="evenodd"></path></svg>
    </a>
    {% endif %}
    <a class="btn btn-invisible circle" onclick="modeSwitch();" title="{{ i18n['switchTheme'] }}" {%- if blogBase['themeMode']=='fix' -%}style="display:none;"{%- endif -%}>
        <svg class="octicon" width="16" height="16" ><path id="themeSwitch" fill-rule="evenodd"></path></svg>
    </a>
</div>
{% endblock %}

{% block content %}
<!-- 文章页 Banner 图片 -->
<div style="text-align: center; margin-bottom: 24px;">
    <img src="{{ blogBase['ogImage'] }}" style="max-width: 100%; border-radius: 8px;" alt="Article Banner">
</div>

<!-- 为 TypeIt 动画预留的占位符 -->
<div id="typeit-animation-container" style="margin-bottom: 24px; min-height: 30px; font-size: 1.2em; font-style: italic; text-align: center;"></div>

<!-- [关键修改] 新增的主体内容容器 -->
<div class="main-content-container">
    <!-- 目录容器，TOC插件将在这里生成目录 -->
    <aside class="toc-container">
        <div id="GmeekTOC"></div>
    </aside>
    <!-- 文章内容容器 -->
    <article class="article-content">
        <div class="markdown-body" id="postBody">{{ blogBase['postBody']|safe }}</div>
        
        <!-- 页脚、广告、评论等都放在文章容器内 -->
        <div class="post-footer">
            <div class="bottom-text-inline">{{ blogBase['bottomText'] }}</div>
            <div class="share-buttons-inline">
                <a id="share-x" class="share-button x" href="#" target="_blank" title="分享到 X">X</a>
                <a id="share-facebook" class="share-button facebook" href="#" target="_blank" title="分享到 Facebook">Facebook</a>
                <a id="share-linkedin" class="share-button linkedin" href="#" target="_blank" title="分享到 LinkedIn">LinkedIn</a>
                <a id="share-weibo" class="share-button weibo" href="#" target="_blank" title="分享到微博">微博</a>
                <a id="share-telegram" class="share-button telegram" href="#" target="_blank" title="分享到 Telegram">Telegram</a>
            </div>
        </div>

        <div style="margin-top: 2rem; margin-bottom: 1rem;">
            <ins class="adsbygoogle" style="display:block; text-align:center;" data-ad-layout="in-article" data-ad-format="fluid" data-ad-client="ca-pub-3409938612356670" data-ad-slot="9927006571"></ins>
            <script>(adsbygoogle = window.adsbygoogle || []).push({});</script>
        </div>

        <div style="margin-top: 2rem;">
            <script src="https://giscus.app/client.js" data-repo="granthuang999/granthuang999.github.io" data-repo-id="R_kgDOPhhmjA" data-category="Announcements" data-category-id="DIC_kwDOPhhmjM4CuggD" data-mapping="url" data-strict="0" data-reactions-enabled="1" data-emit-metadata="0" data-input-position="top" data-theme="preferred_color_scheme" data-lang="zh-CN" crossorigin="anonymous" async></script>
        </div>
    </article>
</div>
{% endblock %}

{% block script %}
<script>
// TypeIt.js, 分享功能, 图标加载等脚本...
// (这部分与您现有的代码一致，为简洁省略，实际文件中应保留)
</script>
<!-- [关键修改] 将自定义脚本包裹在 <script> 标签内 -->
<script>
{{ blogBase['script']|safe }}
</script>
{% endblock %}
