
这份文档记录了我在深度定制我的个人网站 www.futuremedia.work 时，所经历的一系列技术挑战和最终的解决方案。这是一个基于 Gmeek 博客系统的项目，整个过程充满了波折，但也收获颇丰。

**最后更新: 2025年8月24日**

> 核心问题一：自定义导航页 (link.html) 的“血泪史”

我的目标: 我希望创建一个功能强大的个人导航页 link.html，它不仅要有精美的布局，还要有实时搜索和主题切换等交互功能。

**踩坑过程:**

初步尝试: 我最初直接在 Issue 中粘贴完整的 HTML 代码，但发现发布的页面直接显示为源代码。

Gmeek-html 方案: 根据官方文档，我尝试使用 ```Gmeek-html ... ``` 来包裹代码。但问题依旧，页面的<style>和<script>` 部分仍然被当作纯文本显示。

##{...} 配置方案: 接着，我尝试将 HTML、CSS 和 JavaScript 分离，把样式和脚本代码放入文章末尾的 ##{"style": "...", "script": "..."} 配置中。这导致了更多的问题，比如代码因为内部引号冲突而无法被正确解析，或者即使解析成功，模板的安全机制也阻止了脚本的执行。

**根本原因:**

模板安全机制: 我最终发现，post.html 模板为了安全，默认不会执行来自 ##{...} 配置块中的复杂脚本和样式，而是将它们作为普通文本显示。

配置格式的脆弱性: ##{...} 这种配置方式对格式要求极为严格，任何微小的错误（如多余的空格、错误的引号）都会导致解析失败，且不会有明确的错误提示。

**最终决定：回归静态**
在反复折腾后，我决定放弃为这个页面添加复杂的交互功能。我最终采用了一个纯静态的 HTML 片段作为页面内容，只在 ##{...} 中定义了最基础的字体样式。这个方案虽然牺牲了动态功能，但保证了页面的稳定性和可靠性。

> 核心问题二：自定义URL (slug) 和时间戳 (timestamp) 失效

遇到的问题: 我发现在文章末尾的 ##{...} 中添加了 slug 和 timestamp 参数后，旧文章的 URL 依然是标题拼音，发布日期也没有改变。

**排查过程:**

我通过检查 Actions 日志发现，Has Custom JSON parameters 的关键信息没有出现，这证明脚本根本没有读取我的配置。

我一度怀疑是 slug 和 timestamp 同时使用存在冲突，但单独测试 timestamp 依然不生效。

通过“洁净室测试”（新建一篇格式完美的文章），我发现新文章可以成功，但只要编辑过的旧文章就不行。

**根本原因:**

脚本解析逻辑脆弱: 我最终定位到问题根源：Gmeek.py 原始的解析代码只会读取 Issue 正文的最后一行。当我在 GitHub 上编辑旧文章后，编辑器会在末尾自动添加一个或多个看不见的空行，导致脚本找不到我写的配置行。

容错性差: 解析失败后，脚本会静默地将配置视为空对象 {}，不会报错，这给我的排查带来了很大困难。

**最终解决方案:**

我重写了 Gmeek.py 中的 addOnePostJson 函数，修改了它的解析逻辑。

新的逻辑不再只看最后一行，而是从文章末尾向前搜索，找到最后一个有内容的行 (last_meaningful_line) 来进行解析，从而完美地忽略了所有末尾的空行。

> 核心问题三：GitHub Actions 构建失败 (SyntaxError, AttributeError 等)

遇到的问题: 在修改 Gmeek.py 脚本的过程中，我的工作流频繁地因为各种 Python 错误而失败，例如 IndentationError (缩进错误), SyntaxError (语法错误), AttributeError (属性错误)。

排查过程: 只能逐一核对错误日志和对应的代码行，过程非常痛苦。

**根本原因:**

代码传输不完整: 由于和AI助手的协作限制，我很难一次性获得完整的代码文件，自己拼接的代码在函数边界处很容易产生语法错误。

复制粘贴引入错误: 手动复制粘贴 Python 代码时，它严格的缩进格式非常容易被破坏。

笔误: 在后期修改中，还出现了一些低级的拼写错误，比如 blog.blog.blogBase。

**最终解决方案:**

我最终要求AI助手采用分段提供代码的方式，确保我能获得完整的代码。

在最后，我让AI助手提供了一个经过完全验证的、完整的 Gmeek.py 文件，我直接替换了旧文件，避免了所有手动修改可能带来的错误。

> 我的总结

经过这一系列的调试，我的网站终于进入了稳定状态。所有**_核心功能，包括新增自定义页面、新增自定义URL、新增定时发布、修改页眉背景、导入Giscus评论系统、新增Pagefind全文搜索_**等均已正常工作。这次经历让我学到了几个核心经验：

深入理解模板渲染机制，特别是 |safe 这类安全过滤器的作用至关重要。

必须编写健壮的解析代码，要充分考虑到用户（也就是我自己）输入内容时可能出现的各种意外情况（如不同的换行符、末尾空行等）。

优先使用完整文件替换，而不是在原有代码上小修小补，这样能最大限度地避免引入格式和语法错误。
##{"slug": "debugging-log"}